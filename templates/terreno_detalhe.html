{% extends "base.html" %}

{% block content %}
<div class="container mt-4" style="max-width: 900px;">
  <h2>Detalhes do Terreno #{{ terreno.id }}</h2>

  <div class="row">
    <!-- Dados do terreno -->
    <div class="col-md-6 mb-3">
      <table class="table table-sm table-bordered">
        <tbody>
          <tr>
            <th>Bairro</th>
            <td>{{ terreno.bairro }}</td>
          </tr>
          <tr>
            <th>Microárea</th>
            <td>{{ terreno.microarea or "-" }}</td>
          </tr>
          <tr>
            <th>Endereço</th>
            <td>{{ terreno.endereco }}</td>
          </tr>
          <tr>
            <th>Referência</th>
            <td>{{ terreno.referencia }}</td>
          </tr>
          <tr>
            <th>Lixo</th>
            <td>{{ "Sim" if terreno.tem_lixo else "Não" }}</td>
          </tr>
          <tr>
            <th>Água parada</th>
            <td>{{ "Sim" if terreno.tem_agua_parada else "Não" }}</td>
          </tr>
          <tr>
            <th>Risco</th>
            <td>{{ terreno.risco }}</td>
          </tr>
          <tr>
            <th>Situação</th>
            <td>{{ terreno.situacao }}</td>
          </tr>
          <tr>
            <th>Criado por</th>
            <td>{{ terreno.criado_por.nome if terreno.criado_por else "-" }}</td>
          </tr>
          <tr>
            <th>Latitude</th>
            <td>{{ terreno.latitude or "-" }}</td>
          </tr>
          <tr>
            <th>Longitude</th>
            <td>{{ terreno.longitude or "-" }}</td>
          </tr>
          <tr>
            <th>Observações</th>
            <td>{{ terreno.observacoes or "-" }}</td>
          </tr>
        </tbody>
      </table>

      <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Voltar</a>
      <a href="{{ url_for('terreno_editar', terreno_id=terreno.id) }}" class="btn btn-warning">Editar</a>
    </div>

    <!-- Mapa -->
    <div class="col-md-6 mb-3">
      {% if terreno.latitude and terreno.longitude %}
        <div id="map-terreno" style="width: 100%; height: 320px;"></div>
      {% else %}
        <p class="text-muted">Este terreno ainda não possui coordenadas cadastradas.</p>
      {% endif %}
    </div>
  </div>

  <hr>

  <h4>Fotos do terreno</h4>
  {% if fotos %}
    <div class="row">
      {% for foto in fotos %}
        <div class="col-6 col-md-3 mb-3">
          <img
            src="{{ url_for('uploaded_file', filename=foto.caminho_arquivo) }}"
            class="img-fluid img-thumbnail"
            alt="Foto do terreno {{ terreno.id }}"
          >
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">Ainda não há fotos cadastradas para este terreno.</p>
  {% endif %}
</div>

{% if terreno.latitude and terreno.longitude %}
<script>
  // Inicializa mapa apenas se tiver coordenadas
  document.addEventListener("DOMContentLoaded", function () {
    var map = L.map("map-terreno").setView(
      [{{ terreno.latitude }}, {{ terreno.longitude }}],
      18
    );

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    L.marker([{{ terreno.latitude }}, {{ terreno.longitude }}]).addTo(map);
  });
</script>
{% endif %}
{% endblock %}
